---
title: "Semanas de la 14 a la 18. Haciendo útil a NAO"
categories:
  - Weblog
tags:
  - Gazebo Harmonic
  - ROS2 Humble Hawksbill
  - Walking Gate
  - Usos
  - Sensores
---

Las tareas de estas semanas eran cortas, pero intensas, ya que debía incluirle una cámara a NAO, además de arreglar la forma de caminar que tenía, ya que, como se vió en la entrada anterior, era muy imperfecta.

# Añadiendo la cámara

Añadir la cámara era una tarea sencilla, pero a mí se me hizo bastante cuesta arriba, ya que, lo único que tenía que hacer era añadir esto al modelo del NAO:

```xml
<link name="camera_rgb_frame">
    <inertial>
       <pose>0.15 0 0.25 0 0 0</pose>
       <inertia>
       <ixx>0.001</ixx>
       <ixy>0.000</ixy>
       <ixz>0.000</ixz>
       <iyy>0.001</iyy>
       <iyz>0.000</iyz>
       <izz>0.001</izz>
       </inertia>
       <mass>0.035</mass>
    </inertial>
    <pose>0.15 0 0.25 0 0 0</pose>
    <sensor name="camera" type="camera">
       <always_on>true</always_on>
       <visualize>true</visualize>
       <update_rate>30</update_rate>
       <topic>NAO/camera/image_raw</topic>
       <gz_frame_id>camera_rgb_frame</gz_frame_id>
       <camera name="intel_realsense_r200">
       <camera_info_topic>NAO/camera/camera_info</camera_info_topic>
       <horizontal_fov>1.02974</horizontal_fov>
       <image>
       <width>1920</width>
       <height>1080</height>
       <format>R8G8B8</format>
       </image>
       <clip>
       <near>0.02</near>
       <far>300</far>
       </clip>
       <noise>
       <type>gaussian</type>
       <!-- Noise is sampled independently per pixel on each frame.
       That pixel's noise value is added to each of its color
       channels, which at that point lie in the range [0,1]. -->
       <mean>0.0</mean>
       <stddev>0.007</stddev>
       </noise>
       </camera> 
      </sensor>
    </link>
    <plugin filename="gz-sim-sensors-system" name="gz::sim::systems::Sensors">
    	<render_engine>ogre2</render_engine>
    </plugin>
```

Pero, la parte del plugin tardé unos días en encontrarla, por lo que los topics de la cámara no aparecían en mi terminal a la hora de listar todos los topics, cosa que se me hizo cuesta arriba, y no fue hasta que un compañero de clase me enseñó un modelo de sensor en un modelo de robot que me di cuenta de este "código faltante".

Una vez añadido eso correctamente, hice el nuevo bridge necesario en el launcher y ya éramos capaces de ver lo que NAO veía,o eso era lo que yo creía, ya que la cámara aparecía cómo topic y podíamos trabajar con él, pero, al probar con rviz a ver qué imgaen era la que obtenía, no visualizaba nada, sólo un espacio blanco.

Tras un buen rato de mirar todas las posibilidades, me di cuenta de que la cámara estaba cayendo por el infinto, ya que en su información de posición la coordenada z no dejaba de descender, cosa que hizo que me diese cuenta de que no había añadido un joint a la cabeza del nao y la cámara, así que, añadí lo siguiente a mi modelo:

```xml
<joint name="head_camera_joint" type="fixed">
    <parent>Head</parent>
    <child>camera_rgb_frame</child>
    <pose>0.15 0 0.25 0 0 0</pose>
</joint>
```

Una vez añadido este joint fixed (para que no se moviese), por fin las coordenadas de la cámara eran fijas, por lo que decidí ponerle un cubo delante a NAO y, con rviz, visualizar lo que NAO estaba viendo, dejo el resultado a continuación:

![distancia](/2024-tfg-eva-fernandez/images/semanas-14-a-18/camara_colocada.png)

Cosa que me alegró bastante ya que por fin tenía la cámara del nao funcionando, y, por probar, decidí ponerle a andar un poco (aún sin arreglar la manera en la que camina) para ver cómo se comportaba la imagen, cosa que fue de la siguiente manera:

<video width="800" controls>
  <source src="/2024-tfg-eva-fernandez/images/semanas-14-a-18/nao_andando_con_camara.webm" type="video/webm">
  Your browser does not support the video tag.
</video>

# Arreglando la caminata

Para arreglar la caminata, 
