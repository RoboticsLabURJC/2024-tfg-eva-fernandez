---
title: "Semana 27. Parametrizando y generalizando la caminata"
categories:
  - Weblog
tags:
  - Python
  - Ros2 Humble
  - Gazebo Harmonic
  - Parametrización
  - WEBOTS
---

Esta semana era bastante importante, ya que casi todo el peso y dificultad principal de este TFG se abordaría aquí, ya que mis tareas principales eran:
* Ajustar los tiempos en los movimientos para que queden suaves y naturales
* Hacer que NAO andase recto ajustando los rozamientos del mundo
* Solucionar cierta fatiga detectada la semana anterior (explicaremos esto más adelante)
* Caminar recto a distintas velocidades
* Conseguir caminar con velocidad angular para ahcer arcos

También quería matizar algunas cosas, así que me propuse las siguientes tareas secundarias:
* Arreglar por completo el editor para dejarlo zanjado
* Levantar a NAO desde cúbito supino

# TAREAS PRINCIPALES
## Solucionar rozamientos para que NAO ande recto y suavizar la fatiga

Comencé por esta tarea ya que me parecía la más sencilla, ya que llevaba con ella bastante tiempo, por lo que era sólo continuar hasta dar con los parámetros de rozamiento adecuados, tanto en el mundo como en los pies de NAO.

Para hacer esto, simplemente era editar los ficheros sdf del NAO y el mundo y ver qué combinación daba mejores resultados.

Como mientras estaba probando rozamientos tuve muchos casos de fatiga (NAO no responde a las publicaciones en los topics, como si tuviese las articulaciones bloqueadas, ejemplo en este vídeo):

<video width="800" controls>
  <source src="/2024-tfg-eva-fernandez/images/semana-27/ejemplo_fatiga.webm" type="video/webm">
  Your browser does not support the video tag.
</video>


Decidí tirarme de cabeza a solucionar este problema, cosa que conseguí añadiendo una calidad de servicio a mi programa intérprete de movimientos:

```python
qos_profile = QoSProfile(
    reliability=ReliabilityPolicy.RELIABLE,
    history=HistoryPolicy.KEEP_ALL,
    depth=1000
)
```

Cosa que solucionó bastante el tema de la fatiga y me daba muchas ejecuciones antes de que ocurriese de nuevo, por lo que decidí dejarlo así, ya que no era incómodo como antes y de seguro en la aplicación final no llegará a sobrecargarse de esa manera, ya que para probarlo lo ejecuté muchas veces seguidas. Dejo a continuación cómo funcionaba cuando lo arreglé, sin aun solucionar los rozamientos, pero a punto:

<video width="800" controls>
  <source src="/2024-tfg-eva-fernandez/images/semana-27/menor_fatiga.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

Como se puede haber, sigue habiendo fatiga, pero con menor frecuencia y menores consecuencias.

Una vez solucionada la fatiga, continué con el arreglo de los rozamientos.

Cuando lo conseguí, me di cuenta qde que la calidad de servicio no había solucionado tanto como yo creía, ya que tenía muchas cosas abiertas, y se seguía fatigando, por lo pensé que la fatiga se debía a eso y yo no tenía control sobre ello. Por lo que decidí seguir investigándo a ver si encontraba algo al respecto.

En cuanto a esto, dejo aquí una prueba de NAO andando recto y el tema de la fatiga:

<video width="800" controls>
  <source src="/2024-tfg-eva-fernandez/images/semana-27/caminar_recto_con_fatiga.webm" type="video/webm">
  Your browser does not support the video tag.
</video>

## Ajustar tiempos para que los movientos queden suaves y naturales

Como se ve en el vídeo anterior, los movientos ya son bastante suaves, por lo que decidí dejarlo así.

## Probar distintas velocidades para caminar recto
## Caminar en arco

# TAREAS SECUNDARIAS
## Zanjar el editor
## Levantar a NAO de cúbito supino